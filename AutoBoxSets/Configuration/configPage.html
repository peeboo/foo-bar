<!DOCTYPE html>
<html>
<head>
    <title>Auto BoxSets</title>
</head>
<body>
<div id="boxsetsConfigurationPage" data-role="page" class="page type-interior pluginConfigurationPage">

    <div data-role="content">
        <div class="content-primary">
            <h3>This plug-in requires internet metadata fetching be enabled for Collections.</h3>
            <form id="boxsetsConfigurationForm">

                <ul class="ulForm" data-role="listview">
                    <li>
                        <label for="txtMinMembers">
                            Create BoxSets only if I have at least this many of its movies:
                        </label>
                        <input type="number" min="1" id="txtMinMembers" name="txtMinMembers"/>
                    </li>
                    <li>
                        <button type="submit" data-theme="b">Save</button>
                        <button type="button" onclick="history.back();">Cancel</button>
                    </li>
                    <li>
                        <p style="white-space: normal; font-size: 12px">
                            Auto Box Sets will keep itself up to date whenever you add or remove movies from your library. However, some changes like modifications
                            to the tmdb collection ids may not be seen. In those instances, you can manually force a refresh with this button.
                        </p>

                    </li>
                    <li>
                        <button type="button" onclick="BoxSetsConfigurationPage.refreshBoxSets();">Refresh Box Sets</button>

                    </li>
                </ul>

            </form>
        </div>
    </div>

    <script type="text/javascript">

        var BoxSetsConfigurationPage = {
            pluginUniqueId: "899c12c7-5b40-4c4e-9afd-afd74a685eb1",

            refreshBoxSets: function() {
                var url = ApiClient.getUrl("AutoBoxSets/Refresh");
                console.log(url);
                ApiClient.ajax({
                    type: 'post',
                    url: url
                });
                Dashboard.alert("Box Set Refresh Started");

            }

        };

        $('#boxsetsConfigurationPage')
            .on('pageshow',
                function(event) {

                    Dashboard.showLoadingMsg();

                    var page = this;

                    ApiClient.getPluginConfiguration(BoxSetsConfigurationPage.pluginUniqueId)
                        .then(function(config) {

                            $('#txtMinMembers', page).val(config.MinimumMembers);

                            Dashboard.hideLoadingMsg();
                        });
                });

        $('#boxsetsConfigurationForm')
            .on('submit',
                function(e) {

                    Dashboard.showLoadingMsg();

                    var form = this;

                    ApiClient.getPluginConfiguration(BoxSetsConfigurationPage.pluginUniqueId)
                        .then(function(config) {

                            config.MinimumMembers = $('#txtMinMembers', form).val();
                            ApiClient.updatePluginConfiguration(BoxSetsConfigurationPage.pluginUniqueId, config)
                                .then(Dashboard.processPluginConfigurationUpdateResult);
                        });

                    // Disable default form submission
                    return false;
                });
    </script>
</div>
</body>
</html>